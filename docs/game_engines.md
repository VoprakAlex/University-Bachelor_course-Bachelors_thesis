
# Выбор игрового движка

## Реализация поведенческих деревьев в Unity

### Наличие готовой реализации

**Официальный пакет Unity Behavior** — это встроенное решение от Unity, предоставляющее визуальный инструмент для создания поведенческих деревьев (в документации Unity называет их "поведенческими графами" — behavior graphs). В отличие от традиционных деревьев, поведенческие графы в Unity Behavior поддерживают нелинейные структуры, где ветви могут сливаться обратно, что позволяет создавать более сложное и взаимосвязанное поведение. Данный пакет бесплатен для использования.

**Популярные сторонние решения**, доступные через Asset Store, включают Behavior Designer и Behavior Machine. Эти плагины предлагают визуальные редакторы, обширные библиотеки готовых узлов и удобные API. Behavior Designer, например, предоставляет архитектуру, схожую с компонентами Unity MonoBehaviour, что упрощает его освоение.

### Наличие документации

Документация официального пакета Unity Behavior является достаточно подробной и структурированной. Она включает следующие ключевые разделы:

* Базовые концепции: руководство по созданию и открытию поведенческого графа, добавлению узлов и их соединению.
* Практика работы: инструкции по работе с пакетом и импорту примеров.
* Сериализация: объяснение того, как пакет хранит и восстанавливает данные графа и переменные Blackboard между редактором и runtime.
* Решение проблем: описания распространенных проблем при работе с графами, советы по отладке и известные ограничения.

Сторонние плагины, такие как Behavior Designer, также обладают хорошей документацией, учебными пособиями и примерами проектов, что упрощает их освоение.

### Возможность создания собственной реализации

Реализация базовой структуры (узел, селектор, последовательность) достаточно проста.

## Реализация поведенческих деревьев в Unreal Engine

### Наличие готовой реализации

В Unreal Engine присутствует полнофункциональная встроенная система для работы с поведенческими деревьями, которая не является сторонней библиотекой, а составляет неотъемлемую часть движка.

**Ключевые компоненты системы включают:**

* **Behavior Tree**: Основной актив, содержащий древовидную логику принятия решений. Дерево состоит из узлов, которые управляют потоком выполнения (композитные узлы), проверяют условия (декораторы) и выполняют действия (задачи) .
* **Blackboard**: Это "мозг" ИИ, представляющий собой отдельный актив для хранения данных. Blackboard содержит ключи (переменные), такие как `TargetActor` или `HasLineOfSight`, которые Behavior Tree использует для принятия решений и которые могут обновляться извне .
* **AIController**: Класс, который управляет подопечным Pawn (персонажем ИИ). Именно в AIController происходит инициализация и запуск Behavior Tree .
* **Вспомогательные системы**: Движок предоставляет такие компоненты, как `UPawnSensingComponent` для реализации зрения и слуха у ИИ , и **Environment Query System (EQS)** для принятия тактических решений на основе данных об окружающей среде .

### Наличие документации

Официальная документация Epic Games предоставляет обширные материалы, охватывающие как основы, так и продвинутые темы.

* **Базовые руководства**: Имеется пошаговое *Behavior Tree Quick Start Guide*, которое детально описывает создание ИИ, патрулирующего территорию и преследующего игрока . Это руководство знакомит с созданием Blackboard, настройкой дерева, использованием стандартных задач и созданием собственных.
* **Теоретическая база**: Документ *Behavior Trees in Unreal Engine* объясняет общие концепции и, что важно, ключевые отличия реализации UE от классических поведенческих деревьев .
* **Практические примеры и поддержка сообщества**: Существуют многочисленные руководства от сообщества, дополняющие официальную документацию. Например, подробный разбор реализации ИИ для зомби в C++ от разработчика Тома Лумана или пример создания тактического ИИ для шутера. На форумах Unreal Engine можно найти ответы на частые вопросы и решения распространенных проблем .

### Возможность создания собственной реализации

Создание поведенческого дерева в Unreal Engine является относительно простым благодаря визуальному редактору и системе Blueprints, но создание сложного ИИ требует понимания всех компонентов системы.

## Реализация поведенческих деревьев в Godot

### Наличие готовой реализации

В Godot отсутствует официальная встроенная реализация поведенческих деревьев, однако существует несколько активно развивающихся библиотек от сообщества, которые можно установить через Asset Library или вручную.

**LimboAI** — это наиболее мощный и полнофункциональный плагин, реализованный на C++ в виде GDExtension или модуля. Он предоставляет комплексное решение, включающее визуальный редактор деревьев, систему черных досок (Blackboard), визуальный отладчик в реальном времени, а также интеграцию с иерархическими конечными автоматами состояний. Плагин активно поддерживается и совместим с версиями Godot 4.3–4.5 .

**Yet Another Behavior Tree** — это еще одна популярная библиотека, написанная на GDScript. Она предлагает все стандартные узлы (композитные, декораторы, условия и действия), систему черных досок и удобную интеграцию с редактором Godot. Библиотека распространяется под лицензией Apache 2.0 .

**DV's Behavior Tree** — это облегченная GDScript-реализация, позиционирующая себя как модульная и удобная для расширения система для создания адаптивного ИИ .

### Наличие документации

Качество документации варьируется в зависимости от выбранной библиотеки.

**LimboAI** обладает самой обширной и структурированной документацией. Она включает встроенную в редактор справку по всем классам и узлам, онлайн-документацию, а также демонстрационный проект с пошаговым руководством (туториалом), который наглядно объясняет основы работы с поведенческими деревьями на практических примерах .

### Возможность создания собственной реализации

Создание простейшей реализации поведенческого дерева "с нуля" в Godot является относительно простой задачей благодаря архитектуре, основанной на древовидной структуре узлов, и динамическому языку GDScript. Процесс можно описать следующим образом.

## Сравнение игровых движков для разработки пошаговой стратегии с ИИ

| Критерий | Unity | Unreal Engine | Godot |
|----------|-------|---------------|--------|
| **Простота освоения** |  Интуитивный интерфейс, C# с полной типизaцией, минимальные требования к начальной подготовке, обширные обучающие материалы | Сложная структура проекта, требует знания C++ или Blueprints, высокий порог входа для полноценного использования |  Минималистичный интерфейс, простой Python-подобный GDScript, быстрое создание первого проекта |
| **Удобство workflow** | Быстрое прототипирование, гибкая система префабов, хорошая интеграция с системами контроля версий | Высококачественные инструменты из коробки, мощные системы материалов и анимации, профессиональный pipeline для командной работы | Упрощенная структура сцен, быстрое прототипирование, но меньше возможностей для автоматизации процессов |
| **Качество поддержки** | Обширная документация с примерами, активное сообщество, регулярные обновления | Глубокая техническая документация, активная поддержка от Epic Games, сильное enterprise-сообщество | Хорошая базовая документация, активное но меньшее сообщество, медленнее исправление критических багов |
| **Кросс-платформенность** | Поддержка 25+ платформ включая PC, мобильные устройства, консоли, VR/AR и WebGL | Широкая поддержка основных платформ: десктоп, мобильные, консоли, VR/AR системы | Поддержка основных платформ: Windows, Mac, Linux, мобильные ОС, веб-сборки |
| **Производительность** | Оптимизация для мобильных платформ, возможности для высокопроизводительных проектов через DOTS, требует ручной оптимизации для сложных проектов | Высокая производительность из коробки, оптимизированный рендерер для AAA-игр, эффективное использование многопоточности | Подходит для 2D и простых 3D проектов, ограничения для сложных 3D сцен, улучшения в Godot 4 |
| **Графика из коробки** | URP для мобильных проектов, HDRP для высококачественной графики, требует настройки для AAA-качества | Кинематографическое качество из коробки, передовые технологии освещения (Lumen), высококачественные пост-эффекты | Улучшенная графика в Godot 4, современный рендерер с ограничениями, подходит для инди и стилизованной графики |
| **Стоимость и лицензирование** | Бесплатный до $100k/год, Pro-версия с расширенными возможностями, прозрачная модель ценообразования | Бесплатный до первого $1M дохода, 5% роялти после превышения лимита, профессиональный инструментарий | Полностью бесплатный, открытый исходный код (MIT лицензия), никаких роялти, коммерческое использование без ограничений |
| **Экосистема инструментов** | Огромный Asset Store, множество плагинов для Behavior Trees (Behavior Designer), активное сообщество | Marketplace с качественными ассетами, встроенные системы для ИИ (Behavior Trees, EQS), профессиональные инструменты | Растущая библиотека ассетов, несколько реализаций Behavior Trees (LimboAI), активное развитие сообществом |
| **Мультиплеер и сети** | Netcode for GameObjects, Mirror, надежные решения для различных типов multiplayer | Мощная встроенная система репликации, профессиональные инструменты для сетевых игр | Простые сетевые API, требует доработки для сложных multiplayer проектов |
| **Поддержка 2D/3D** | Равноценная поддержка 2D и 3D разработки, мощные инструменты для обоих направлений | Ориентация на 3D-графику, ограниченные возможности для чистого 2D | Хорошая поддержка 2D, развивающиеся возможности для 3D |

## Выбор

Для самоличной реализации поведенческих деревьев в игровых движках, я решил выбрать **Unity**. Этот движок предоставляет наиболее сбалансированную экосистему для быстрого старта и эффективной работы, сочетая простоту освоения, мощные сторонние инструменты и гибкость для кастомной реализации.

Unity является оптимальным вариантом по нескольким причинам:

* **Низкий порог входа**: Интерфейс Unity интуитивно понятен, а для написания логики используется C# — язык
* **Гибкость и контроль**: В отличие от Unreal Engine, где поведенческие деревья являются "монолитной" встроенной системой, архитектура Unity позволяет выбрать готовое решение или легко создать собственную реализацию, давая полный контроль над кодом и производительностью.

### Реализация в Unity

Основой является создание базового класса `Node` с методом `Tick()`, возвращающим статус `Success`, `Failure` или `Running`. Затем реализуются ключевые узлы:

* **Sequence**: Последовательно выполняет дочерние узлы, пока все не завершатся успехом.
* **Selector**: Выполняет дочерние узлы, пока один из них не вернет успех.
* **Decorator**: Модифицирует поведение одного дочернего узла.
* **Action & Condition**: Исполнительные "листья" дерева.
